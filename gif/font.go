package gif

import "image/color"

// font8x8 contains a basic 8x8 bitmap font for ASCII characters 32-126.
// Each character is represented as 8 bytes, where each byte is a row of 8 bits.
// A set bit (1) means the pixel should be drawn.
var font8x8 = map[rune][8]byte{
	' ':  {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
	'!':  {0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x18, 0x00},
	'"':  {0x6C, 0x6C, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00},
	'#':  {0x6C, 0x6C, 0xFE, 0x6C, 0xFE, 0x6C, 0x6C, 0x00},
	'$':  {0x18, 0x3E, 0x60, 0x3C, 0x06, 0x7C, 0x18, 0x00},
	'%':  {0x00, 0x66, 0xAC, 0xD8, 0x36, 0x6A, 0xCC, 0x00},
	'&':  {0x38, 0x6C, 0x68, 0x76, 0xDC, 0xCE, 0x7B, 0x00},
	'\'': {0x18, 0x18, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00},
	'(':  {0x0C, 0x18, 0x30, 0x30, 0x30, 0x18, 0x0C, 0x00},
	')':  {0x30, 0x18, 0x0C, 0x0C, 0x0C, 0x18, 0x30, 0x00},
	'*':  {0x00, 0x66, 0x3C, 0xFF, 0x3C, 0x66, 0x00, 0x00},
	'+':  {0x00, 0x18, 0x18, 0x7E, 0x18, 0x18, 0x00, 0x00},
	',':  {0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x30},
	'-':  {0x00, 0x00, 0x00, 0x7E, 0x00, 0x00, 0x00, 0x00},
	'.':  {0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00},
	'/':  {0x06, 0x0C, 0x18, 0x30, 0x60, 0xC0, 0x80, 0x00},
	'0':  {0x3C, 0x66, 0x6E, 0x7E, 0x76, 0x66, 0x3C, 0x00},
	'1':  {0x18, 0x38, 0x18, 0x18, 0x18, 0x18, 0x7E, 0x00},
	'2':  {0x3C, 0x66, 0x06, 0x0C, 0x18, 0x30, 0x7E, 0x00},
	'3':  {0x3C, 0x66, 0x06, 0x1C, 0x06, 0x66, 0x3C, 0x00},
	'4':  {0x0C, 0x1C, 0x3C, 0x6C, 0x7E, 0x0C, 0x0C, 0x00},
	'5':  {0x7E, 0x60, 0x7C, 0x06, 0x06, 0x66, 0x3C, 0x00},
	'6':  {0x1C, 0x30, 0x60, 0x7C, 0x66, 0x66, 0x3C, 0x00},
	'7':  {0x7E, 0x06, 0x0C, 0x18, 0x30, 0x30, 0x30, 0x00},
	'8':  {0x3C, 0x66, 0x66, 0x3C, 0x66, 0x66, 0x3C, 0x00},
	'9':  {0x3C, 0x66, 0x66, 0x3E, 0x06, 0x0C, 0x38, 0x00},
	':':  {0x00, 0x18, 0x18, 0x00, 0x18, 0x18, 0x00, 0x00},
	';':  {0x00, 0x18, 0x18, 0x00, 0x18, 0x18, 0x30, 0x00},
	'<':  {0x0C, 0x18, 0x30, 0x60, 0x30, 0x18, 0x0C, 0x00},
	'=':  {0x00, 0x00, 0x7E, 0x00, 0x7E, 0x00, 0x00, 0x00},
	'>':  {0x30, 0x18, 0x0C, 0x06, 0x0C, 0x18, 0x30, 0x00},
	'?':  {0x3C, 0x66, 0x06, 0x0C, 0x18, 0x00, 0x18, 0x00},
	'@':  {0x3C, 0x66, 0x6E, 0x6A, 0x6E, 0x60, 0x3E, 0x00},
	'A':  {0x18, 0x3C, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x00},
	'B':  {0x7C, 0x66, 0x66, 0x7C, 0x66, 0x66, 0x7C, 0x00},
	'C':  {0x3C, 0x66, 0x60, 0x60, 0x60, 0x66, 0x3C, 0x00},
	'D':  {0x78, 0x6C, 0x66, 0x66, 0x66, 0x6C, 0x78, 0x00},
	'E':  {0x7E, 0x60, 0x60, 0x7C, 0x60, 0x60, 0x7E, 0x00},
	'F':  {0x7E, 0x60, 0x60, 0x7C, 0x60, 0x60, 0x60, 0x00},
	'G':  {0x3C, 0x66, 0x60, 0x6E, 0x66, 0x66, 0x3E, 0x00},
	'H':  {0x66, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x00},
	'I':  {0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x7E, 0x00},
	'J':  {0x3E, 0x0C, 0x0C, 0x0C, 0x0C, 0x6C, 0x38, 0x00},
	'K':  {0x66, 0x6C, 0x78, 0x70, 0x78, 0x6C, 0x66, 0x00},
	'L':  {0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7E, 0x00},
	'M':  {0xC6, 0xEE, 0xFE, 0xD6, 0xC6, 0xC6, 0xC6, 0x00},
	'N':  {0x66, 0x76, 0x7E, 0x7E, 0x6E, 0x66, 0x66, 0x00},
	'O':  {0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00},
	'P':  {0x7C, 0x66, 0x66, 0x7C, 0x60, 0x60, 0x60, 0x00},
	'Q':  {0x3C, 0x66, 0x66, 0x66, 0x6A, 0x6C, 0x36, 0x00},
	'R':  {0x7C, 0x66, 0x66, 0x7C, 0x6C, 0x66, 0x66, 0x00},
	'S':  {0x3C, 0x66, 0x60, 0x3C, 0x06, 0x66, 0x3C, 0x00},
	'T':  {0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00},
	'U':  {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00},
	'V':  {0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x00},
	'W':  {0xC6, 0xC6, 0xC6, 0xD6, 0xFE, 0xEE, 0xC6, 0x00},
	'X':  {0x66, 0x66, 0x3C, 0x18, 0x3C, 0x66, 0x66, 0x00},
	'Y':  {0x66, 0x66, 0x66, 0x3C, 0x18, 0x18, 0x18, 0x00},
	'Z':  {0x7E, 0x06, 0x0C, 0x18, 0x30, 0x60, 0x7E, 0x00},
	'[':  {0x3C, 0x30, 0x30, 0x30, 0x30, 0x30, 0x3C, 0x00},
	'\\': {0xC0, 0x60, 0x30, 0x18, 0x0C, 0x06, 0x03, 0x00},
	']':  {0x3C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x3C, 0x00},
	'^':  {0x18, 0x3C, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00},
	'_':  {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7E, 0x00},
	'`':  {0x30, 0x18, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00},
	'a':  {0x00, 0x00, 0x3C, 0x06, 0x3E, 0x66, 0x3E, 0x00},
	'b':  {0x60, 0x60, 0x7C, 0x66, 0x66, 0x66, 0x7C, 0x00},
	'c':  {0x00, 0x00, 0x3C, 0x66, 0x60, 0x66, 0x3C, 0x00},
	'd':  {0x06, 0x06, 0x3E, 0x66, 0x66, 0x66, 0x3E, 0x00},
	'e':  {0x00, 0x00, 0x3C, 0x66, 0x7E, 0x60, 0x3C, 0x00},
	'f':  {0x1C, 0x30, 0x30, 0x7C, 0x30, 0x30, 0x30, 0x00},
	'g':  {0x00, 0x00, 0x3E, 0x66, 0x66, 0x3E, 0x06, 0x3C},
	'h':  {0x60, 0x60, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x00},
	'i':  {0x18, 0x00, 0x38, 0x18, 0x18, 0x18, 0x3C, 0x00},
	'j':  {0x0C, 0x00, 0x1C, 0x0C, 0x0C, 0x0C, 0x6C, 0x38},
	'k':  {0x60, 0x60, 0x66, 0x6C, 0x78, 0x6C, 0x66, 0x00},
	'l':  {0x38, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3C, 0x00},
	'm':  {0x00, 0x00, 0x6C, 0xFE, 0xD6, 0xC6, 0xC6, 0x00},
	'n':  {0x00, 0x00, 0x7C, 0x66, 0x66, 0x66, 0x66, 0x00},
	'o':  {0x00, 0x00, 0x3C, 0x66, 0x66, 0x66, 0x3C, 0x00},
	'p':  {0x00, 0x00, 0x7C, 0x66, 0x66, 0x7C, 0x60, 0x60},
	'q':  {0x00, 0x00, 0x3E, 0x66, 0x66, 0x3E, 0x06, 0x06},
	'r':  {0x00, 0x00, 0x7C, 0x66, 0x60, 0x60, 0x60, 0x00},
	's':  {0x00, 0x00, 0x3E, 0x60, 0x3C, 0x06, 0x7C, 0x00},
	't':  {0x30, 0x30, 0x7C, 0x30, 0x30, 0x30, 0x1C, 0x00},
	'u':  {0x00, 0x00, 0x66, 0x66, 0x66, 0x66, 0x3E, 0x00},
	'v':  {0x00, 0x00, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x00},
	'w':  {0x00, 0x00, 0xC6, 0xC6, 0xD6, 0xFE, 0x6C, 0x00},
	'x':  {0x00, 0x00, 0x66, 0x3C, 0x18, 0x3C, 0x66, 0x00},
	'y':  {0x00, 0x00, 0x66, 0x66, 0x66, 0x3E, 0x06, 0x3C},
	'z':  {0x00, 0x00, 0x7E, 0x0C, 0x18, 0x30, 0x7E, 0x00},
	'{':  {0x0E, 0x18, 0x18, 0x70, 0x18, 0x18, 0x0E, 0x00},
	'|':  {0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00},
	'}':  {0x70, 0x18, 0x18, 0x0E, 0x18, 0x18, 0x70, 0x00},
	'~':  {0x00, 0x00, 0x60, 0xF2, 0x9E, 0x0C, 0x00, 0x00},
}

// BitmapFont represents a bitmap font with fixed dimensions.
type BitmapFont struct {
	Width  int
	Height int
}

// Bitmap font constants for backward compatibility.
const (
	FontWidth  = 8
	FontHeight = 8
)

// Predefined bitmap fonts.
var (
	// BitmapFont8x8 is the classic 8x8 bitmap font.
	BitmapFont8x8 = BitmapFont{Width: 8, Height: 8}

	// BitmapFont8x16 is a taller 8x16 font for better terminal appearance.
	BitmapFont8x16 = BitmapFont{Width: 8, Height: 16}
)

// getGlyph returns the 8x8 bitmap for a character.
// Returns a block character for unsupported glyphs.
func getGlyph(r rune) [8]byte {
	if glyph, ok := font8x8[r]; ok {
		return glyph
	}
	// Return a block character for unsupported glyphs
	return [8]byte{0xFF, 0x81, 0x81, 0x81, 0x81, 0x81, 0x81, 0xFF}
}

// getGlyph8x16 returns an 8x16 bitmap for a character.
// The glyph is created by vertically scaling the 8x8 font with additional
// spacing for better readability.
func getGlyph8x16(r rune) [16]byte {
	glyph8 := getGlyph(r)

	// Create 8x16 by adding top/bottom padding and doubling key rows
	// Layout: 2 blank rows, 12 rows from scaled 8x8, 2 blank rows
	var glyph16 [16]byte

	// Top padding (rows 0-1)
	glyph16[0] = 0x00
	glyph16[1] = 0x00

	// Scale 8x8 to 12 rows (rows 2-13)
	// Use a simple scaling: each of the 8 rows maps to 1.5 rows
	// We'll duplicate some rows to achieve this
	glyph16[2] = glyph8[0]
	glyph16[3] = glyph8[0]
	glyph16[4] = glyph8[1]
	glyph16[5] = glyph8[2]
	glyph16[6] = glyph8[2]
	glyph16[7] = glyph8[3]
	glyph16[8] = glyph8[4]
	glyph16[9] = glyph8[4]
	glyph16[10] = glyph8[5]
	glyph16[11] = glyph8[6]
	glyph16[12] = glyph8[6]
	glyph16[13] = glyph8[7]

	// Bottom padding (rows 14-15)
	glyph16[14] = 0x00
	glyph16[15] = 0x00

	return glyph16
}

// DrawBitmapChar draws a bitmap character at the given pixel position.
// It supports both 8x8 and 8x16 fonts.
func DrawBitmapChar(f *Frame, px, py int, char rune, fg color.Color, font BitmapFont) {
	if font.Height == 16 {
		glyph := getGlyph8x16(char)
		for row := 0; row < 16; row++ {
			for col := 0; col < 8; col++ {
				if glyph[row]&(0x80>>col) != 0 {
					f.SetPixel(px+col, py+row, fg)
				}
			}
		}
	} else {
		glyph := getGlyph(char)
		for row := 0; row < 8; row++ {
			for col := 0; col < 8; col++ {
				if glyph[row]&(0x80>>col) != 0 {
					f.SetPixel(px+col, py+row, fg)
				}
			}
		}
	}
}
